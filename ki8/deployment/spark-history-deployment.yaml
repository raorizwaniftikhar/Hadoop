apiVersion: v1
kind: Service
metadata:
  name: spark-history
  namespace: bigdata
spec:
  selector:
    app: spark-history
  ports:
    - port: 18080
      targetPort: 18080
      name: ui
      nodePort: 31880
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: spark-history
  namespace: bigdata
spec:
  replicas: 1
  selector:
    matchLabels:
      app: spark-history
  template:
    metadata:
      labels:
        app: spark-history
    spec:
      containers:
        - name: spark-history
          image: bitnami/spark:latest
          command:
            - "/opt/bitnami/spark/bin/spark-class"
            - "org.apache.spark.deploy.history.HistoryServer"
          env:
            - name: SPARK_MODE
              value: history-server
            - name: SPARK_HISTORY_OPTS
              value: >-
                -Dspark.history.fs.logDirectory=hdfs://namenode:8020/spark-history -Dspark.history.ui.port=18080 -Dspark.history.ui.acls.enable=false
                -Dspark.hadoop.security.authentication=NOSASL
                -Dhadoop.security.authentication=NOSASL
                -DHADOOP_USER_NAME=spark
          ports:
            - containerPort: 18080
          tty: true
